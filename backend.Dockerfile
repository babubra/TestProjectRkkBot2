# ===============================================
# Dockerfile для Backend-сервиса (FastAPI)
# ===============================================

# --- ЭТАП 1: Базовый образ ---
# Используем официальный, легковесный образ Python 3.11.
FROM python:3.11-slim

# --- ЭТАП 2: Установка рабочей директории ---
# Все последующие команды будут выполняться внутри этой папки в контейнере.
WORKDIR /app

# --- ЭТАП 3: Установка зависимостей ---
# Копируем только файл с зависимостями, чтобы использовать кэш Docker.
# Переустановка будет происходить только если этот файл изменится.
COPY map_backend/requirements.txt /app/

# Устанавливаем библиотеки, указанные в requirements.txt.
# --no-cache-dir уменьшает размер итогового образа.
RUN pip install --no-cache-dir -r requirements.txt

# --- ЭТАП 4: Копирование исходного кода ---
# Копируем весь код бэкенда в соответствующую папку внутри контейнера.
COPY map_backend/ /app/map_backend/

# --- ЭТАП 5: Команда запуска ---
# Определяем команду, которая будет выполнена при запуске контейнера.
# Запускаем приложение с помощью uvicorn.
# --host 0.0.0.0 делает сервер доступным извне контейнера.
# --port 8000 указывает порт, на котором будет работать приложение.
CMD ["uvicorn", "map_backend.main:app", "--host", "0.0.0.0", "--port", "8000"]